<!-- Login Section -->
<section class="hero-section min-h-screen flex items-center justify-center py-24">
    <div class="max-w-md w-full mx-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 feature-card">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">Welcome Back</h1>
                <p class="text-gray-600">Sign in to access your CargoZig account</p>
            </div>

            <form id="loginForm">
                <div class="mb-4">
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                    <input type="email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#007185] focus:border-transparent" id="email" name="email" required placeholder="Enter your email">
                </div>
                <div class="mb-6">
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input type="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#007185] focus:border-transparent" id="password" name="password" required placeholder="Enter your password">
                </div>

                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center">
                        <input type="checkbox" id="remember" name="remember" class="h-4 w-4 text-[#007185] focus:ring-[#007185] border-gray-300 rounded">
                        <label for="remember" class="ml-2 block text-sm text-gray-700">Remember me</label>
                    </div>
                    <a href="/forgot-password" class="text-sm text-[#007185] hover:text-[#C7511F]">Forgot password?</a>
                </div>

                <button type="submit" class="btn-primary w-full mb-4" id="loginBtn">
                    <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                    Sign In
                </button>

                <div id="errorMessage" class="alert alert-danger d-none" role="alert"></div>
                <div id="successMessage" class="alert alert-success d-none" role="alert"></div>
            </form>

            <div class="text-center mt-6">
                <p class="text-gray-600">Don't have an account?
                    <a href="/register" class="text-[#007185] hover:text-[#C7511F] font-medium">Sign up here</a>
                </p>
            </div>

            <div class="text-center mt-4">
                <p class="text-sm text-gray-500">
                    Freight broker? <a href="/toc/login" class="text-[#007185] hover:text-[#C7511F] font-medium">Access Admin Portal</a>
                </p>
            </div>
        </div>
    </div>
</section>

<!-- Login Form Script -->
<script>
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const loginBtn = document.getElementById('loginBtn');
        const spinner = loginBtn.querySelector('.spinner-border');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');

        // Show loading state
        loginBtn.disabled = true;
        if (spinner) spinner.classList.remove('d-none');
        loginBtn.textContent = 'Signing in...';
        errorMessage.classList.add('d-none');
        successMessage.classList.add('d-none');

        try {
            const response = await fetch('/api/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    email: document.getElementById('email').value,
                    password: document.getElementById('password').value
                })
            });

            const data = await response.json();

            if (response.ok) {
                // Store JWT token
                localStorage.setItem('jwt_token', data.token);
                localStorage.setItem('user', JSON.stringify(data.user));

                successMessage.textContent = 'Login successful! Redirecting...';
                successMessage.classList.remove('d-none');

                // Redirect based on user role
                setTimeout(() => {
                    if (data.user.roles && data.user.roles.includes('admin')) {
                        window.location.href = '/dashboard';
                    } else {
                        window.location.href = '/dashboard';
                    }
                }, 1500);
            } else {
                errorMessage.textContent = data.error || 'Login failed. Please try again.';
                errorMessage.classList.remove('d-none');
                loginBtn.textContent = 'Sign In';
            }
        } catch (error) {
            console.error('Login error:', error);
            errorMessage.textContent = 'Network error. Please try again.';
            errorMessage.classList.remove('d-none');
            loginBtn.textContent = 'Sign In';
        } finally {
            // Hide loading state
            loginBtn.disabled = false;
            if (spinner) spinner.classList.add('d-none');
        }
    });

    // Check if user is already logged in
    document.addEventListener('DOMContentLoaded', function() {
        const token = localStorage.getItem('jwt_token');
        if (token) {
            // Redirect to dashboard if already logged in
            window.location.href = '/dashboard';
        }
    });
</script>

<style>
    .spinner-border {
        display: inline-block;
        width: 1rem;
        height: 1rem;
        border: 0.25em solid currentColor;
        border-right-color: transparent;
        border-radius: 50%;
        animation: spinner-border 0.75s linear infinite;
    }
    .alert {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
    }
    .alert-danger {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }
    .alert-success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }
    .d-none {
        display: none !important;
    }
    @keyframes spinner-border {
        to {
            transform: rotate(360deg);
        }
    }
</style>
